# Everything from this: https://stackoverflow.com/questions/38903996/cimg-x11-linking-error-using-clion-and-cmake
cmake_minimum_required(VERSION 3.10)

# set(CMAKE_CXX_COMPILER "g++")
# set(CMAKE_CXX_STANDARD 17)

add_library(CImgLib STATIC include/CImg.h dummy.cpp)
target_include_directories(CImgLib PUBLIC include)
# You can alter these according to your needs, e.g if you don't need to display images - set(YOU_NEED_X11 0)
set(YOU_NEED_X11 0)
set(YOU_NEED_PNG 0)
set(YOU_NEED_JPG 0)
set(YOU_NEED_TIFF 0)
set(YOU_NEED_THREADS 1)
set(YOU_NEED_OPENMP 0)

if (BLUEMARBLE_USE_CIMG_WINDOW)
    if(WIN32)
        target_compile_definitions(CImgLib PUBLIC cimg_display=2)
    elseif(UNIX)
        set(YOU_NEED_X11 1)
    endif()
else()
    target_compile_definitions(CImgLib PUBLIC cimg_display=0)
endif()

if (BLUEMARBLE_USE_CIMG_RASTER_IMPL)
    set(YOU_NEED_PNG 1)
    set(YOU_NEED_JPG 1)
    set(YOU_NEED_TIFF 1)
endif()

if(${YOU_NEED_THREADS} EQUAL 1)
    message(STATUS "Looking for Threads...")
    find_package(Threads REQUIRED)
    #include_directories(${CMAKE_THREAD_LIBS_INIT})
    target_link_libraries(CImgLib PRIVATE ${CMAKE_THREAD_LIBS_INIT})
endif()

if(${YOU_NEED_X11} EQUAL 1)
    message(STATUS "Looking for X11...")
    find_package(X11 REQUIRED)
    target_include_directories(CImgLib PUBLIC ${X11_INCLUDE_DIR})
    target_link_libraries(CImgLib PRIVATE ${X11_LIBRARIES})
endif()



if (YOU_NEED_OPENMP)
    message(STATUS "Looking for OpenMP...")
    find_package(OpenMP REQUIRED)
    if (OpenMP_CXX_FOUND)
        message(STATUS "OpenMP found: ${OpenMP_CXX_FLAGS}")
        target_link_libraries(CImgLib PUBLIC OpenMP::OpenMP_CXX)
    else()
        message(FATAL_ERROR "OpenMP not found!")
    endif()
    target_compile_definitions(CImgLib PUBLIC cimg_use_openmp=1)
endif()

if(${YOU_NEED_JPG} EQUAL 1)
    message(STATUS "Looking for libjpg...")
    find_package(JPEG REQUIRED)
    target_include_directories(CImgLib PUBLIC ${JPEG_INCLUDE_DIR})
    target_link_libraries (CImgLib PRIVATE ${JPEG_LIBRARY})
    target_compile_definitions(CImgLib PUBLIC cimg_use_jpeg=1)
endif()

if(${YOU_NEED_PNG} EQUAL 1)
    message(STATUS "Looking for libpng...")
    find_package(PNG REQUIRED)
    target_include_directories(CImgLib PUBLIC ${PNG_INCLUDE_DIR})
    target_link_libraries (CImgLib PRIVATE ${PNG_LIBRARY})
    target_compile_definitions(CImgLib PUBLIC cimg_use_png=1)
endif()

if(${YOU_NEED_TIFF} EQUAL 1)
    message(STATUS "Looking for libtif...")
    find_package(TIFF REQUIRED)
    target_include_directories(CImgLib PUBLIC ${TIFF_INCLUDE_DIR})
    target_link_libraries (CImgLib PRIVATE ${TIFF_LIBRARY})
    target_compile_definitions(CImgLib PUBLIC cimg_use_tiff=1)
endif()

message(STATUS "CImgLib CXX Flags: ${CMAKE_CXX_FLAGS}")
